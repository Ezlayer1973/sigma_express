<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sigma Express ‚Äî POS</title>
<link href="https://fonts.googleapis.com/css2?family=Figtree:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --sidebar-w: 240px;
    --bg: #f0ede8;
    --sidebar-bg: #1c1917;
    --sidebar-hover: #292524;
    --sidebar-active: #ea580c;
    --card: #ffffff;
    --border: #e2ddd8;
    --accent: #ea580c;
    --accent-hover: #c2410c;
    --text: #1c1917;
    --muted: #78716c;
    --success: #16a34a;
    --danger: #dc2626;
    --input-bg: #fafaf9;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family: 'Figtree', sans-serif; background: var(--bg); color: var(--text); display: flex; min-height: 100vh; }

  /* SIDEBAR */
  .sidebar {
    width: var(--sidebar-w); background: var(--sidebar-bg);
    display: flex; flex-direction: column;
    position: fixed; top:0; left:0; height:100vh;
    z-index: 100; overflow-y: auto;
  }
  .sidebar-logo {
    padding: 24px 20px 20px;
    border-bottom: 1px solid #292524;
  }
  .logo-tag { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--accent); letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 4px; }
  .logo-name { font-size: 18px; font-weight: 900; color: #fff; line-height: 1.1; }
  .logo-sub { font-size: 11px; color: #78716c; margin-top: 2px; }

  .sidebar-section { padding: 20px 12px 8px; }
  .sidebar-section-label {
    font-size: 10px; text-transform: uppercase; letter-spacing: 0.12em;
    color: #57534e; font-weight: 600; padding: 0 8px; margin-bottom: 6px;
  }

  .nav-item {
    display: flex; align-items: center; gap: 10px;
    padding: 9px 12px; border-radius: 8px; cursor: pointer;
    color: #a8a29e; font-size: 13.5px; font-weight: 500;
    transition: all 0.15s; user-select: none;
    border: none; background: none; width: 100%; text-align: left;
  }
  .nav-item:hover { background: var(--sidebar-hover); color: #fff; }
  .nav-item.active { background: var(--accent); color: #fff; }
  .nav-item .nav-icon { font-size: 15px; width: 20px; text-align: center; flex-shrink: 0; }

  .nav-group { margin-bottom: 4px; }
  .nav-group-header {
    display: flex; align-items: center; gap: 10px;
    padding: 9px 12px; border-radius: 8px; cursor: pointer;
    color: #a8a29e; font-size: 13.5px; font-weight: 500;
    transition: all 0.15s; user-select: none;
  }
  .nav-group-header:hover { background: var(--sidebar-hover); color: #fff; }
  .nav-group-header .chevron { margin-left: auto; font-size: 11px; transition: transform 0.2s; }
  .nav-group.open .nav-group-header .chevron { transform: rotate(180deg); }
  .nav-group.open .nav-group-header { color: #fff; }

  .nav-children { overflow: hidden; max-height: 0; transition: max-height 0.3s ease; }
  .nav-group.open .nav-children { max-height: 300px; }
  .nav-children .nav-item { padding-left: 42px; font-size: 13px; }

  .sidebar-footer { margin-top: auto; padding: 16px 12px; border-top: 1px solid #292524; }
  .sidebar-footer .version { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: #57534e; }

  /* MAIN */
  .main { margin-left: var(--sidebar-w); flex: 1; display: flex; flex-direction: column; min-height: 100vh; }

  .topbar {
    background: var(--card); border-bottom: 1px solid var(--border);
    padding: 0 32px; height: 56px;
    display: flex; align-items: center; justify-content: space-between;
    position: sticky; top:0; z-index:50;
  }
  .topbar-title { font-size: 15px; font-weight: 700; color: var(--text); }
  .topbar-breadcrumb { font-size: 12px; color: var(--muted); font-family: 'JetBrains Mono', monospace; }

  .content { padding: 32px; flex: 1; }

  /* WELCOME */
  .welcome { text-align: center; padding: 80px 32px; }
  .welcome-icon { font-size: 56px; margin-bottom: 20px; }
  .welcome h2 { font-size: 1.8rem; font-weight: 800; margin-bottom: 8px; }
  .welcome p { color: var(--muted); font-size: 14px; }

  /* PANEL */
  .panel { display: none; animation: fadeIn 0.25s ease; }
  .panel.active { display: block; }
  @keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

  .panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; flex-wrap: wrap; gap: 12px; }
  .panel-title { font-size: 1.4rem; font-weight: 800; }
  .panel-subtitle { font-size: 13px; color: var(--muted); margin-top: 2px; }

  /* BUTTON */
  .btn {
    display: inline-flex; align-items: center; gap: 7px;
    padding: 9px 18px; border-radius: 8px; font-size: 13.5px;
    font-weight: 600; cursor: pointer; border: none;
    font-family: 'Figtree', sans-serif; transition: all 0.15s;
  }
  .btn-primary { background: var(--accent); color: #fff; }
  .btn-primary:hover { background: var(--accent-hover); }
  .btn-ghost { background: transparent; color: var(--muted); border: 1px solid var(--border); }
  .btn-ghost:hover { background: var(--bg); color: var(--text); }
  .btn-danger { background: #fee2e2; color: var(--danger); border: 1px solid #fecaca; }
  .btn-danger:hover { background: #fecaca; }
  .btn-sm { padding: 5px 12px; font-size: 12px; border-radius: 6px; }

  /* CARD */
  .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
  .card-body { padding: 24px; }

  /* FORM */
  .form-group { margin-bottom: 18px; }
  .form-label { display: block; font-size: 12.5px; font-weight: 600; color: var(--text); margin-bottom: 6px; }
  .form-input {
    width: 100%; padding: 10px 14px; border: 1.5px solid var(--border);
    border-radius: 8px; font-size: 14px; font-family: 'Figtree', sans-serif;
    background: var(--input-bg); color: var(--text); transition: border-color 0.15s;
    outline: none;
  }
  .form-input:focus { border-color: var(--accent); }

  /* TABLE */
  .table-wrap { overflow-x: auto; }
  table { width: 100%; border-collapse: collapse; font-size: 13.5px; }
  thead th {
    text-align: left; padding: 10px 16px;
    font-size: 11px; font-weight: 700; text-transform: uppercase;
    letter-spacing: 0.08em; color: var(--muted);
    background: #faf9f8; border-bottom: 1px solid var(--border);
  }
  tbody tr { border-bottom: 1px solid #f5f3f0; transition: background 0.1s; }
  tbody tr:hover { background: #faf9f8; }
  tbody tr:last-child { border-bottom: none; }
  tbody td { padding: 12px 16px; }
  .td-code { font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--muted); }

  /* BADGE */
  .badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 8px; border-radius: 999px; font-size: 11px; font-weight: 600; }
  .badge-active { background: #dcfce7; color: #15803d; }
  .badge-inactive { background: #fee2e2; color: #991b1b; }

  /* TOAST */
  .toast-wrap { position: fixed; bottom: 24px; right: 24px; display: flex; flex-direction: column; gap: 8px; z-index: 999; }
  .toast {
    background: var(--text); color: #fff; padding: 12px 18px;
    border-radius: 10px; font-size: 13px; font-weight: 500;
    display: flex; align-items: center; gap: 8px;
    animation: slideUp 0.3s ease;
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
  }
  .toast.success { background: var(--success); }
  .toast.error { background: var(--danger); }
  @keyframes slideUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }

  /* EMPTY STATE */
  .empty { text-align: center; padding: 48px; color: var(--muted); }
  .empty-icon { font-size: 36px; margin-bottom: 12px; }
  .empty p { font-size: 13px; }

  /* MODAL */
  .modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.4);
    display: none; align-items: center; justify-content: center; z-index: 200;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--card); border-radius: 16px; padding: 28px;
    width: 100%; max-width: 420px; margin: 16px;
    animation: fadeIn 0.2s ease;
  }
  .modal-title { font-size: 16px; font-weight: 800; margin-bottom: 20px; }
  .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
</style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-tag">POS</div>
    <div class="logo-name">Sigma<br>Express</div>
    <div class="logo-sub">v1.0</div>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-label">Principal</div>
    <button class="nav-item" onclick="showPanel('welcome')">
      <span class="nav-icon">üè†</span> Inicio
    </button>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-label">Tablas</div>

    <div class="nav-group open" id="group-tablas">
      <div class="nav-group-header" onclick="toggleGroup('tablas')">
        <span class="nav-icon">üóÇÔ∏è</span>
        <span>Tablas maestras</span>
        <span class="chevron">‚ñæ</span>
      </div>
      <div class="nav-children">
        <button class="nav-item" onclick="showPanel('rubros')">
          <span class="nav-icon">üè∑Ô∏è</span> Rubros
        </button>
        <button class="nav-item" onclick="showPanel('articulos')">
          <span class="nav-icon">üì¶</span> Art√≠culos
        </button>
        <button class="nav-item" onclick="showPanel('clientes')">
          <span class="nav-icon">üë•</span> Clientes
        </button>
      </div>
    </div>

    <div class="nav-group" id="group-ventas">
      <div class="nav-group-header" onclick="toggleGroup('ventas')">
        <span class="nav-icon">üßæ</span>
        <span>Ventas</span>
        <span class="chevron">‚ñæ</span>
      </div>
      <div class="nav-children">
        <button class="nav-item" onclick="showPanel('nueva-venta')">
          <span class="nav-icon">‚ûï</span> Nueva venta
        </button>
        <button class="nav-item" onclick="showPanel('historial')">
          <span class="nav-icon">üìã</span> Historial
        </button>
      </div>
    </div>
  </div>

  <div class="sidebar-footer">
    <div class="version">sigma_express ¬© 2025</div>
  </div>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <div>
      <div class="topbar-title" id="topbar-title">Inicio</div>
      <div class="topbar-breadcrumb" id="topbar-breadcrumb">sigma_express / inicio</div>
    </div>
    <div style="display:flex;align-items:center;gap:12px">
      <span style="font-size:13px;color:var(--muted)">üë§ <span id="topbar-usuario"></span></span>
      <button class="btn btn-ghost" style="font-size:12px;padding:6px 14px" onclick="logout()">Salir</button>
    </div>
  </div>

  <div class="content">

    <!-- WELCOME -->
    <div class="panel active" id="panel-welcome">
      <div class="welcome">
        <div class="welcome-icon">üßæ</div>
        <h2>Bienvenido a Sigma Express</h2>
        <p>Seleccion√° una opci√≥n del men√∫ para comenzar.</p>
      </div>
    </div>

    <!-- RUBROS -->
    <div class="panel" id="panel-rubros">
      <div class="panel-header">
        <div>
          <div class="panel-title">üè∑Ô∏è Rubros</div>
          <div class="panel-subtitle">Alta, baja y modificaci√≥n de rubros</div>
        </div>
      </div>

      <div class="card" style="margin-bottom:20px">
        <div class="card-body">
          <div style="font-size:13px;font-weight:700;margin-bottom:14px;">Nuevo rubro</div>
          <div style="display:grid;grid-template-columns:1fr auto;gap:12px;align-items:end">
            <div class="form-group" style="margin:0">
              <input class="form-input" type="text" id="rubro-desc" placeholder="Descripci√≥n del rubro..." />
            </div>
            <button class="btn btn-primary" onclick="crearRubro()">Ôºã Agregar</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th style="width:80px">C√≥digo</th>
                <th>Descripci√≥n</th>
                <th style="width:100px">Estado</th>
                <th style="width:120px">Acciones</th>
              </tr>
            </thead>
            <tbody id="tabla-rubros">
              <tr><td colspan="4"><div class="empty"><div class="empty-icon">‚è≥</div><p>Cargando...</p></div></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ARTICULOS -->
    <div class="panel" id="panel-articulos">
      <div class="panel-header">
        <div>
          <div class="panel-title">üì¶ Art√≠culos</div>
          <div class="panel-subtitle">Alta, baja y modificaci√≥n de art√≠culos</div>
        </div>
      </div>

      <div class="card" style="margin-bottom:20px">
        <div class="card-body">
          <div style="font-size:13px;font-weight:700;margin-bottom:14px;">Nuevo art√≠culo</div>
          <div style="display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:12px;align-items:end">
            <div class="form-group" style="margin:0">
              <label class="form-label">Descripci√≥n</label>
              <input class="form-input" type="text" id="art-desc" placeholder="Nombre del art√≠culo..." />
            </div>
            <div class="form-group" style="margin:0">
              <label class="form-label">Rubro</label>
              <select class="form-input" id="art-rubro">
                <option value="">Cargando...</option>
              </select>
            </div>
            <div class="form-group" style="margin:0">
              <label class="form-label">Precio</label>
              <input class="form-input" type="number" id="art-precio" placeholder="0.00" step="0.01" min="0" />
            </div>
            <button class="btn btn-primary" onclick="crearArticulo()" style="height:42px;margin-top:auto">Ôºã Agregar</button>
          </div>
          <div style="margin-top:14px">
            <label class="form-label">C√≥digo de barra (opcional)</label>
            <input class="form-input" type="text" id="art-codbarra" placeholder="Escane√° o escrib√≠ el c√≥digo..." style="max-width:300px"/>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th style="width:70px">C√≥digo</th>
                <th>Descripci√≥n</th>
                <th>Rubro</th>
                <th style="width:120px">Precio</th>
                <th style="width:100px">Estado</th>
                <th style="width:120px">Acciones</th>
              </tr>
            </thead>
            <tbody id="tabla-articulos">
              <tr><td colspan="6"><div class="empty"><div class="empty-icon">‚è≥</div><p>Cargando...</p></div></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- CLIENTES -->
    <div class="panel" id="panel-clientes">
      <div class="panel-header">
        <div>
          <div class="panel-title">üë• Clientes</div>
          <div class="panel-subtitle">Alta, baja y modificaci√≥n de clientes</div>
        </div>
        <button class="btn btn-primary" onclick="abrirNuevoCliente()">Ôºã Nuevo cliente</button>
      </div>

      <div class="card">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th style="width:70px">C√≥digo</th>
                <th>Apellido y Nombre</th>
                <th style="width:100px">Doc</th>
                <th>Tel√©fono</th>
                <th>Email</th>
                <th style="width:100px">Estado</th>
                <th style="width:120px">Acciones</th>
              </tr>
            </thead>
            <tbody id="tabla-clientes">
              <tr><td colspan="7"><div class="empty"><div class="empty-icon">‚è≥</div><p>Cargando...</p></div></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- NUEVA VENTA placeholder -->
    <div class="panel" id="panel-nueva-venta">
      <div class="panel-header">
        <div><div class="panel-title">‚ûï Nueva Venta</div><div class="panel-subtitle">Pr√≥ximamente</div></div>
      </div>
      <div class="card"><div class="card-body"><div class="empty"><div class="empty-icon">üöß</div><p>Este m√≥dulo se habilitar√° en el pr√≥ximo paso.</p></div></div></div>
    </div>

    <!-- HISTORIAL placeholder -->
    <div class="panel" id="panel-historial">
      <div class="panel-header">
        <div><div class="panel-title">üìã Historial de Ventas</div><div class="panel-subtitle">Pr√≥ximamente</div></div>
      </div>
      <div class="card"><div class="card-body"><div class="empty"><div class="empty-icon">üöß</div><p>Este m√≥dulo se habilitar√° en el pr√≥ximo paso.</p></div></div></div>
    </div>

  </div>
</main>

<!-- MODAL EDITAR RUBRO -->
<div class="modal-overlay" id="modal-editar-rubro">
  <div class="modal">
    <div class="modal-title">‚úèÔ∏è Editar Rubro</div>
    <input type="hidden" id="edit-rubro-id" />
    <div class="form-group">
      <label class="form-label">Descripci√≥n</label>
      <input class="form-input" type="text" id="edit-rubro-desc" />
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="cerrarModalRubro()">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarEdicionRubro()">Guardar</button>
    </div>
  </div>
</div>

<!-- MODAL NUEVO / EDITAR CLIENTE -->
<div class="modal-overlay" id="modal-cliente">
  <div class="modal" style="max-width:520px">
    <div class="modal-title" id="modal-cliente-title">‚ûï Nuevo Cliente</div>
    <input type="hidden" id="cli-id" />
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <div class="form-group" style="grid-column:1/-1">
        <label class="form-label">Apellido y Nombre *</label>
        <input class="form-input" type="text" id="cli-apellynom" placeholder="Ej: Garc√≠a Juan" />
      </div>
      <div class="form-group">
        <label class="form-label">Tipo de documento</label>
        <select class="form-input" id="cli-tipodoc">
          <option value="">Sin documento</option>
          <option value="DNI">DNI</option>
          <option value="CUIT">CUIT</option>
          <option value="CUIL">CUIL</option>
          <option value="PAS">Pasaporte</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">N√∫mero de documento</label>
        <input class="form-input" type="text" id="cli-nrodoc" placeholder="Ej: 28.123.456" />
      </div>
      <div class="form-group">
        <label class="form-label">Tel√©fono</label>
        <input class="form-input" type="text" id="cli-telefono" placeholder="Ej: 11-1234-5678" />
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input class="form-input" type="email" id="cli-email" placeholder="Ej: juan@mail.com" />
      </div>
      <div class="form-group" style="grid-column:1/-1">
        <label class="form-label">Direcci√≥n</label>
        <input class="form-input" type="text" id="cli-direccion" placeholder="Ej: Av. Corrientes 1234, CABA" />
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="cerrarModalCliente()">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarCliente()">Guardar</button>
    </div>
  </div>
</div>

<!-- MODAL EDITAR ARTICULO -->
<div class="modal-overlay" id="modal-editar-art">
  <div class="modal" style="max-width:480px">
    <div class="modal-title">‚úèÔ∏è Editar Art√≠culo</div>
    <input type="hidden" id="edit-art-id" />
    <div class="form-group">
      <label class="form-label">Descripci√≥n</label>
      <input class="form-input" type="text" id="edit-art-desc" />
    </div>
    <div class="form-group">
      <label class="form-label">Rubro</label>
      <select class="form-input" id="edit-art-rubro"></select>
    </div>
    <div class="form-group">
      <label class="form-label">Precio</label>
      <input class="form-input" type="number" id="edit-art-precio" step="0.01" min="0" />
    </div>
    <div class="form-group">
      <label class="form-label">C√≥digo de barra</label>
      <input class="form-input" type="text" id="edit-art-codbarra" />
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="cerrarModalArt()">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarEdicionArt()">Guardar</button>
    </div>
  </div>
</div>

<!-- TOASTS -->
<div class="toast-wrap" id="toasts"></div>

<script>
 // ‚îÄ‚îÄ AUTENTICACI√ìN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const token = sessionStorage.getItem('token');
const usuarioLogueado = sessionStorage.getItem('usuario');

if (!token) {
  window.location.href = 'login.html';
}

// Mostrar usuario en topbar
document.getElementById('topbar-usuario').textContent = usuarioLogueado || '';

function logout() {
  sessionStorage.removeItem('token');
  sessionStorage.removeItem('usuario');
  window.location.href = 'login.html';
}

// Agregar token a todos los fetch autom√°ticamente
const _fetch = window.fetch;
window.fetch = function(url, options = {}) {
  options.headers = options.headers || {};
  if (token) options.headers['Authorization'] = `Bearer ${token}`;
  return _fetch(url, options);

};
  const API = 'http://127.0.0.1:8000';

  // ‚îÄ‚îÄ NAVEGACI√ìN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const titles = {
    'welcome':     ['Inicio',            'sigma_express / inicio'],
    'rubros':      ['Rubros',            'sigma_express / tablas / rubros'],
    'articulos':   ['Art√≠culos',         'sigma_express / tablas / art√≠culos'],
    'clientes':    ['Clientes',          'sigma_express / tablas / clientes'],
    'nueva-venta': ['Nueva Venta',       'sigma_express / ventas / nueva'],
    'historial':   ['Historial',         'sigma_express / ventas / historial'],
  };

  function showPanel(name) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById('panel-' + name).classList.add('active');
    const [title, breadcrumb] = titles[name] || [name, name];
    document.getElementById('topbar-title').textContent = title;
    document.getElementById('topbar-breadcrumb').textContent = breadcrumb;
    document.querySelectorAll('.nav-item').forEach(btn => {
      if (btn.getAttribute('onclick') === `showPanel('${name}')`) btn.classList.add('active');
    });
    if (name === 'rubros')    cargarRubros();
    if (name === 'articulos') { cargarRubrosSelect('art-rubro'); cargarArticulos(); }
    if (name === 'clientes')  cargarClientes();
  }

  function toggleGroup(name) {
    document.getElementById('group-' + name).classList.toggle('open');
  }

  // ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function toast(msg, type = '') {
    const wrap = document.getElementById('toasts');
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.textContent = (type === 'success' ? '‚úì ' : type === 'error' ? '‚úï ' : '‚Ñπ ') + msg;
    wrap.appendChild(t);
    setTimeout(() => t.remove(), 3000);
  }

  // ‚îÄ‚îÄ RUBROS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function cargarRubros() {
    const tbody = document.getElementById('tabla-rubros');
    tbody.innerHTML = `<tr><td colspan="4"><div class="empty"><div class="empty-icon">‚è≥</div><p>Cargando...</p></div></td></tr>`;
    try {
      const res = await fetch(`${API}/rubros/`);
      const data = await res.json();
      const rubros = data.datos;
      if (!rubros || rubros.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4"><div class="empty"><div class="empty-icon">üè∑Ô∏è</div><p>No hay rubros cargados todav√≠a.</p></div></td></tr>`;
        return;
      }
      tbody.innerHTML = rubros.map(r => `
        <tr>
          <td class="td-code">#${r[0]}</td>
          <td style="font-weight:500">${r[1]}</td>
          <td><span class="badge ${r[2] ? 'badge-inactive' : 'badge-active'}">${r[2] ? '‚óè Baja' : '‚óè Activo'}</span></td>
          <td style="display:flex;gap:6px">
            <button class="btn btn-ghost btn-sm" onclick="abrirEditarRubro(${r[0]}, '${r[1]}')">‚úèÔ∏è</button>
            <button class="btn btn-danger btn-sm" onclick="eliminarRubro(${r[0]}, '${r[1]}')">üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
    } catch (ex) {
      tbody.innerHTML = `<tr><td colspan="4"><div class="empty"><div class="empty-icon">‚ö†Ô∏è</div><p>Error al conectar con el servidor.</p></div></td></tr>`;
      toast('Error al conectar con la API', 'error');
    }
  }

  async function crearRubro() {
    const desc = document.getElementById('rubro-desc').value.trim();
    if (!desc) { toast('Ingres√° una descripci√≥n', 'error'); return; }
    try {
      const res = await fetch(`${API}/rubros/`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ descripcion: desc, baja: false })
      });
      if (res.ok) {
        const data = await res.json();
        toast(`Rubro creado con c√≥digo #${data.codigo}`, 'success');
        document.getElementById('rubro-desc').value = '';
        cargarRubros();
      } else {
        toast('Error al crear el rubro', 'error');
      }
    } catch (ex) {
      toast('Error al conectar con la API', 'error');
    }
  }

  function abrirEditarRubro(id, desc) {
    document.getElementById('edit-rubro-id').value = id;
    document.getElementById('edit-rubro-desc').value = desc;
    document.getElementById('modal-editar-rubro').classList.add('open');
  }

  function cerrarModalRubro() {
    document.getElementById('modal-editar-rubro').classList.remove('open');
  }

  async function guardarEdicionRubro() {
    const id = document.getElementById('edit-rubro-id').value;
    const desc = document.getElementById('edit-rubro-desc').value.trim();
    if (!desc) { toast('Ingres√° una descripci√≥n', 'error'); return; }
    try {
      const res = await fetch(`${API}/rubros/${id}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ descripcion: desc, baja: false })
      });
      if (res.ok) {
        toast('Rubro actualizado', 'success');
        cerrarModalRubro();
        cargarRubros();
      } else {
        toast('Error al actualizar', 'error');
      }
    } catch (ex) {
      toast('Error al conectar con la API', 'error');
    }
  }

  async function eliminarRubro(id, desc) {
    if (!confirm(`¬øDar de baja el rubro "${desc}"?`)) return;
    try {
      const res = await fetch(`${API}/rubros/${id}`, { method: 'DELETE' });
      if (res.status === 204 || res.ok) {
        toast(`Rubro "${desc}" dado de baja`, 'success');
        cargarRubros();
      } else {
        toast('Error al eliminar', 'error');
      }
    } catch (ex) {
      toast('Error al conectar con la API', 'error');
    }
  }

  document.getElementById('modal-editar-rubro').addEventListener('click', function(e) {
    if (e.target === this) cerrarModalRubro();
  });

  document.getElementById('rubro-desc').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') crearRubro();
  });

  // ‚îÄ‚îÄ ART√çCULOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function cargarRubrosSelect(selectId) {
    try {
      const res = await fetch(`${API}/rubros/`);
      const data = await res.json();
      const rubros = data.datos || [];
      const select = document.getElementById(selectId);
      select.innerHTML = `<option value="">Seleccion√° un rubro...</option>` +
        rubros.map(r => `<option value="${r[0]}">${r[1]}</option>`).join('');
    } catch (ex) {
      toast('Error al cargar rubros', 'error');
    }
  }

  async function cargarArticulos() {
    const tbody = document.getElementById('tabla-articulos');
    tbody.innerHTML = `<tr><td colspan="6"><div class="empty"><div class="empty-icon">‚è≥</div><p>Cargando...</p></div></td></tr>`;
    try {
      const res = await fetch(`${API}/articulos/`);
      const data = await res.json();
      const articulos = data.datos;
      if (!articulos || articulos.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6"><div class="empty"><div class="empty-icon">üì¶</div><p>No hay art√≠culos cargados todav√≠a.</p></div></td></tr>`;
        return;
      }
      tbody.innerHTML = articulos.map(a => `
        <tr>
          <td class="td-code">#${a[0]}</td>
          <td style="font-weight:500">${a[1]}</td>
          <td><span style="font-size:12px;color:var(--muted)">${a[3] || '-'}</span></td>
          <td style="font-family:'JetBrains Mono',monospace;font-size:13px">$${parseFloat(a[4]).toLocaleString('es-AR', {minimumFractionDigits:2})}</td>
          <td><span class="badge ${a[7] ? 'badge-inactive' : 'badge-active'}">${a[7] ? '‚óè Baja' : '‚óè Activo'}</span></td>
          <td style="display:flex;gap:6px">
            <button class="btn btn-ghost btn-sm" onclick="abrirEditarArt(${a[0]}, '${a[1].replace(/'/g, "\\'")}', ${a[2]}, ${a[4]}, '${(a[5] || '').replace(/'/g, "\\'")}')">‚úèÔ∏è</button>
            <button class="btn btn-danger btn-sm" onclick="eliminarArticulo(${a[0]}, '${a[1].replace(/'/g, "\\'")}')">üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
    } catch (ex) {
      tbody.innerHTML = `<tr><td colspan="6"><div class="empty"><div class="empty-icon">‚ö†Ô∏è</div><p>Error al conectar con el servidor.</p></div></td></tr>`;
      toast('Error al conectar con la API', 'error');
    }
  }

  async function crearArticulo() {
    const desc   = document.getElementById('art-desc').value.trim();
    const rubro  = document.getElementById('art-rubro').value;
    const precio = document.getElementById('art-precio').value;
    const codBarra = document.getElementById('art-codbarra').value.trim();

    if (!desc)              { toast('Ingres√° una descripci√≥n', 'error'); return; }
    if (!rubro)             { toast('Seleccion√° un rubro', 'error'); return; }
    if (!precio || precio <= 0) { toast('Ingres√° un precio v√°lido', 'error'); return; }

    try {
      const res = await fetch(`${API}/articulos/`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          descripcion: desc,
          cod_rubro: parseInt(rubro),
          precio: parseFloat(precio),
          codigo_barra: codBarra || null,
          baja: false
        })
      });
      if (res.ok) {
        const data = await res.json();
        toast(`Art√≠culo creado con c√≥digo #${data.codigo}`, 'success');
        document.getElementById('art-desc').value = '';
        document.getElementById('art-precio').value = '';
        document.getElementById('art-codbarra').value = '';
        cargarArticulos();
      } else {
        toast('Error al crear el art√≠culo', 'error');
      }
    } catch (ex) {
      toast('Error al conectar con la API', 'error');
    }
  }

  async function abrirEditarArt(id, desc, codRubro, precio, codBarra) {
    document.getElementById('edit-art-id').value = id;
    document.getElementById('edit-art-desc').value = desc;
    document.getElementById('edit-art-precio').value = precio;
    document.getElementById('edit-art-codbarra').value = codBarra;
    await cargarRubrosSelect('edit-art-rubro');
    document.getElementById('edit-art-rubro').value = codRubro;
    document.getElementById('modal-editar-art').classList.add('open');
  }

  function cerrarModalArt() {
    document.getElementById('modal-editar-art').classList.remove('open');
  }

  async function guardarEdicionArt() {
    const id       = document.getElementById('edit-art-id').value;
    const desc     = document.getElementById('edit-art-desc').value.trim();
    const rubro    = document.getElementById('edit-art-rubro').value;
    const precio   = document.getElementById('edit-art-precio').value;
    const codBarra = document.getElementById('edit-art-codbarra').value.trim();

    if (!desc) { toast('Ingres√° una descripci√≥n', 'error'); return; }

    try {
      const res = await fetch(`${API}/articulos/${id}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          descripcion: desc,
          cod_rubro: parseInt(rubro),
          precio: parseFloat(precio),
          codigo_barra: codBarra || null,
          baja: false
        })
      });
      if (res.ok) {
        toast('Art√≠culo actualizado', 'success');
        cerrarModalArt();
        cargarArticulos();
      } else {
        toast('Error al actualizar', 'error');
      }
    } catch (ex) {
      toast('Error al conectar con la API', 'error');
    }
  }

  async function eliminarArticulo(id, desc) {
    if (!confirm(`¬øDar de baja el art√≠culo "${desc}"?`)) return;
    try {
      const res = await fetch(`${API}/articulos/${id}`, { method: 'DELETE' });
      if (res.status === 204 || res.ok) {
        toast(`Art√≠culo "${desc}" dado de baja`, 'success');
        cargarArticulos();
      } else {
        toast('Error al eliminar', 'error');
      }
    } catch (ex) {
      toast('Error al conectar con la API', 'error');
    }
  }

  document.getElementById('modal-editar-art').addEventListener('click', function(e) {
    if (e.target === this) cerrarModalArt();
  });

  document.getElementById('art-desc').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') crearArticulo();
  });

  // ‚îÄ‚îÄ CLIENTES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function cargarClientes() {
    const tbody = document.getElementById('tabla-clientes');
    tbody.innerHTML = `<tr><td colspan="7"><div class="empty"><div class="empty-icon">‚è≥</div><p>Cargando...</p></div></td></tr>`;
    try {
      const res = await fetch(`${API}/clientes/`);
      const data = await res.json();
      const clientes = data.datos;
      if (!clientes || clientes.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7"><div class="empty"><div class="empty-icon">üë•</div><p>No hay clientes cargados todav√≠a.</p></div></td></tr>`;
        return;
      }
      tbody.innerHTML = clientes.map(c => `
        <tr>
          <td class="td-code">#${c[0]}</td>
          <td style="font-weight:500">${c[1]}</td>
          <td><span style="font-size:12px;color:var(--muted)">${c[2] ? c[2]+' '+c[3] : '-'}</span></td>
          <td style="font-size:13px">${c[4] || '-'}</td>
          <td style="font-size:13px;color:var(--muted)">${c[5] || '-'}</td>
          <td><span class="badge ${c[8] ? 'badge-inactive' : 'badge-active'}">${c[8] ? '‚óè Baja' : '‚óè Activo'}</span></td>
          <td style="display:flex;gap:6px">
            <button class="btn btn-ghost btn-sm" onclick="abrirEditarCliente(${c[0]}, '${(c[1]||'').replace(/'/g,"\\'")}', '${c[2]||''}', '${c[3]||''}', '${c[4]||''}', '${c[5]||''}', '${(c[6]||'').replace(/'/g,"\\'")}')">‚úèÔ∏è</button>
            <button class="btn btn-danger btn-sm" onclick="eliminarCliente(${c[0]}, '${(c[1]||'').replace(/'/g,"\\'")}')">üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
    } catch (ex) {
      tbody.innerHTML = `<tr><td colspan="7"><div class="empty"><div class="empty-icon">‚ö†Ô∏è</div><p>Error al conectar con el servidor.</p></div></td></tr>`;
      toast('Error al conectar con la API', 'error');
    }
  }

function abrirNuevoCliente() {
    document.getElementById('cli-id').value = '';
    document.getElementById('cli-apellynom').value = '';
    document.getElementById('cli-tipodoc').value = '';
    document.getElementById('cli-nrodoc').value = '';
    document.getElementById('cli-telefono').value = '';
    document.getElementById('cli-email').value = '';
    document.getElementById('cli-direccion').value = '';
    document.getElementById('modal-cliente-title').textContent = '‚ûï Nuevo Cliente';
    document.getElementById('modal-cliente').classList.add('open');
    setTimeout(() => document.getElementById('cli-apellynom').focus(), 100);
  }

  function abrirEditarCliente(id, apellynom, tipodoc, nrodoc, telefono, email, direccion) {
    document.getElementById('cli-id').value = id;
    document.getElementById('cli-apellynom').value = apellynom;
    document.getElementById('cli-tipodoc').value = tipodoc;
    document.getElementById('cli-nrodoc').value = nrodoc;
    document.getElementById('cli-telefono').value = telefono;
    document.getElementById('cli-email').value = email;
    document.getElementById('cli-direccion').value = direccion;
    document.getElementById('modal-cliente-title').textContent = '‚úèÔ∏è Editar Cliente';
    document.getElementById('modal-cliente').classList.add('open');
  }

  function cerrarModalCliente() {
    document.getElementById('modal-cliente').classList.remove('open');
  }

  async function guardarCliente() {
    const id       = document.getElementById('cli-id').value;
    const apellynom = document.getElementById('cli-apellynom').value.trim();
    const tipodoc  = document.getElementById('cli-tipodoc').value;
    const nrodoc   = document.getElementById('cli-nrodoc').value.trim();
    const telefono = document.getElementById('cli-telefono').value.trim();
    const email    = document.getElementById('cli-email').value.trim();
    const direccion = document.getElementById('cli-direccion').value.trim();

    if (!apellynom) { toast('El apellido y nombre es obligatorio', 'error'); return; }

    const body = JSON.stringify({
      apellynom, tipo_doc: tipodoc || null, nro_doc: nrodoc || null,
      telefono: telefono || null, email: email || null,
      direccion: direccion || null, baja: false
    });

    try {
      const url    = id ? `${API}/clientes/${id}` : `${API}/clientes/`;
      const method = id ? 'PUT' : 'POST';
      const res = await fetch(url, { method, headers: {'Content-Type': 'application/json'}, body });
      if (res.ok) {
        toast(id ? 'Cliente actualizado' : 'Cliente creado correctamente', 'success');
        cerrarModalCliente();
        cargarClientes();
      } else {
        toast('Error al guardar el cliente', 'error');
      }
    } catch (ex) {
      toast('Error al conectar con la API', 'error');
    }
  }

  async function eliminarCliente(id, nombre) {
    if (!confirm(`¬øDar de baja al cliente "${nombre}"?`)) return;
    try {
      const res = await fetch(`${API}/clientes/${id}`, { method: 'DELETE' });
      if (res.status === 204 || res.ok) {
        toast(`Cliente "${nombre}" dado de baja`, 'success');
        cargarClientes();
      } else {
        toast('Error al eliminar', 'error');
      }
    } catch (ex) {
      toast('Error al conectar con la API', 'error');
    }
  }

  document.getElementById('modal-cliente').addEventListener('click', function(e) {
    if (e.target === this) cerrarModalCliente();
  });

</script>
</body>
</html>
